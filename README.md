# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

**Товар в каталоге**

```ts
export interface IProduct {
  id: string;           // уникальный идентификатор
  description: string;  // описание
  image: string;     // URL изображения
  title: string;         // название
  category: string;     // категория
  price: number | null;        // цена в рублях
}
```
**Покупатель**

```ts
export interface IBuyer {
  payment: string;
  email: string;
  phone: string;
  address: string;
  total: number; // общая сумма заказа
  items: string[]; // список идентификаторов товаров в заказе
}
```

**Интерфейс для модели данных товаров**
```ts
export interface IProductsData {
  products: IProduct[]; // массив товаров
  preview: string | null; // выбранная карточка товара
  getProduct(id: string): IProduct | undefined; // метод для получения товара по ID
  getProducts() : IProduct[]; //метод для получения всех товаров
  setProducts(products: IProduct[]) : void; //добавления множества товаров
  setPreview(product: IProduct) : void; // добавление одного товара
}
```
**Интерфейс для модели данных корзины**

```ts
export interface ICartData {
  items: TCartItem[]; // массив товаров в корзине
  addItem(product: IProduct): void; // метод для добавления товара в корзину
  removeItem(id: string): void; // метод для удаления товара из корзины
  clear(): void; // метод для очистки корзины
  checkProduct(id: string): boolean; // метод для проверки наличия товаров в корзине
  getItemsId(): string[]; // метод для получения всех товаров в корзине
  getItemsCount() : number; // метод для получения количества товаров в корзине
  getItemsTotal() : number; // метод дял получения общей стоимости товаров в корзине
}
```

**Интерфейс для модели данных заказа**
```ts
export interface IBuyersData{
  order: IBuyer; // данные заказа
  //errors: МОЖЕТ ПОНАДОБИТЬСЯ
  setPaymentData(data: Record<keyof TPaymentForm, string>) : void;
  setContactData(data: Record<keyof TContactForm, string>) : void;
  chekPaymentValidation(data: Record<keyof TPaymentForm, string>): 
  boolean; // метод для проверки валидности формы оплаты
  chekContactValidation(data: Record<keyof TContactForm, string>): boolean; // метод для проверки валидности формы контактов
  clear() : void; // метод очистки данных заказа
}
```

## Архитектура приложения
Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.


### Базовый код

#### Класс Арі
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет `GET` запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse` - обработчик ответа сервера

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ProductsData

Класс отвечает за хранение данных карточек товаров. Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- `_products: IProduct[]` - массив объектов карточек
- `_preview: string | null` - id товара, выбранного для просмотра в модальной окне
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `getProduct(id: string): IProduct | undefined` - возвращает товар по его id
- `getProducts() : IProduct[]` - получение списка продуктов
- `setProducts(products: IProduct[]) : void` - добавление продуктов
- `setPreview(product: IProduct) : void` - выбор продукта для просмотра
- `getPreview() : Iproduct` - возвращает выбранный для просмотра продукт

#### Класс CartData

Класс отвечает за функционировнаие корзины. Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:

- `_items: IProduct[]` - массив товаров в корзине
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `addItem(product: IProduct): void` - метод для добавления товара в корзину
- `removeItem(id: string): void` - метод для удаления товара из корзины
- `clear(): void` - метод для очистки корзины
- `checkProduct(id: string): boolean` - метод для проверки наличия товаров в корзине
- `getItemsId(): string[]` - метод для получения всех индификаторов товаров в корзине
- `getItemsCount() : number` - метод для получения количества товаров в корзине
- `getItemsTotal() : number` - метод дял получения общей стоимости товаров в корзине
- `getItems() : TCartItem[]` - метод получения всех элементов в корзине


#### Класс BuyersData
Класс отвечает за хранение и логику работы с данными пеокупателя. Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:

- `order: IBuyer` - информация о заказе
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `setPaymentData(data: Record<keyof TPaymentForm, string>) : void;`
- `setContactData(data: Record<keyof TContactForm, string>) : void` - метод записи контактной информации
- `clear() : void` - метод очистки данных заказа
- `chekPaymentValidation(data: Record<keyof TPaymentForm, string>): boolean;` - метод для проверки валидности формы оплаты
- `chekContactValidation(data: Record<keyof TContactForm, string>): boolean;` - метод для проверки валидности формы контактов
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса


### Класс представления

Все классы пердствавления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Отвечает за отображение модального окна и управление его состоянием. Предоставляет методы `open` и `close` для открытия и закрытия окна. Устанавливает обработчики событий для закрытия по нажатию клавиши *Escape*, клику на оверлей и нажатию на кнопку-крестик. Предоставляет метод `render` для отображения содержимого.

- `constructor(selector: string, events: IEvents)` - Принимает селектор для поиска элемента модального окна в DOM и экземпляр брокера событий (класса `EventEmitter`), обеспечивающего генерацию и обработку событий.

Поля класса:
- `modal`: HTMLElement — DOM-элемент модального окна.
- `events`: IEvents — экземпляр брокера событий для публикации и обработки событий внутри приложения.
- `closeButton : HTMLButtonElement` - кнопка закрытия модального окна
- `content` - контейнер для содержимого


#### Класс Product
Отвечает за отображение карточки товара, задавая название, категорию, цену и изображение товара. Класс используется для отображения товаров на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события. \
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий. 

Методы:
- `setData (productData: IProduct): void` - заполняет атрибуты элементов карточки данными.
- `addToCart` - вызывает добавление каточки в корзину и изменение кнопки на удаление из корзины
- `render(): HTMLElement;` - возвращает полностью заполненную карточку с установленными слушателями
- геттер id возвращает уникальный id карточки



#### Класс Cart

Класс `Cart` отвечает за управление корзиной товаров на странице. Он включает в себя отображение списка товаров, расчет общей стоимости и обработку пользовательских действий, таких как оформление заказа.

- `constructor(container: HTMLElement, events: IEvents)` - Принимает контейнер элемента и экземпляр брокера событий (класса `EventEmitter`), обеспечивающего генерацию и обработку событий.

Методы:
- `updateButtonState` - метод изменяет состояние кнопки оформления заказа в зависимости от суммы товаров в корзине: если сумма больше нуля, кнопка активируется (удаляется атрибут disabled), иначе — блокируется (атрибут disabled добавляется).
- `set price(value: number)` - сеттер устанавливает общую стоимость товаров в корзине.
- `set items(items: HTMLElement[])` — сеттер для обновления списка товаров в корзине.

#### Класс Form

Класс `Form` представляет компонент формы в веб-приложении. Он принимает универсальный параметр `T`, который задаёт тип данных формы.

- `constructor(container: HTMLElement, events: IEvents)` - Принимает элемент, который будет являться контейнером формы и экземпляр брокера событий (класса `EventEmitter`), обеспечивающего генерацию и обработку событий.

Методы:

- `onChange(field: keyof T, value: string)` - Метод вызывается при изменении значения любого поля ввода в форме.
- `render(state: Partial & IFormValidator)` - Метод используется для обновления состояния формы.
- `set valid(value: boolean)` - сеттер устанавливает состояние валидности формы. Он принимает значение типа boolean и устанавливает атрибут disabled на кнопке отправки формы в зависимости от значения. Если значение true, кнопка становится активной, если false - неактивной.
- `set errors(value: string)` - сеттер устанавливает текст ошибок формы.

#### Класс OrderPayment

Он наследуется от класса `Form` и принимает generic-параметр `TPaymentForm`, который определяет структуру данных формы оплаты.
Отвечает за управление выбором способа оплаты и адресом доставки в форме заказа.

- `_buttonOnline: HTMLButtonElement` — кнопка для выбора оплаты онлайн (картой)
- `_buttonCash: HTMLButtonElement` — кнопка для выбора оплаты при получении
- `_address: HTMLInputElement` — поле для ввода адреса доставки.

Методы:

- `set address(value: string)` — сеттер для поля адреса, который устанавливает адрес доставки.
- `togglePayment(value: HTMLElement)` — метод для переключения выбранного способа оплаты.
- `resetPayment()` — метод для сброса состояния кнопок оплаты, используется при переключении кнопок.

#### Класс OrderContacts

Он наследуется от класса `Form` и принимает generic-параметр `TContactForm` Отвечает за управление контактными данными — электронной почтой и номером телефона — в форме оформления заказа.

Поля класса:

- `_email: HTMLInputElement` — поле ввода для электронной почты.
- `_phone: HTMLInputElement` — поле ввода для номера телефона.

Методы:
- `set phone(value: string)` - сеттер для поля телефона
- `set email(value: string)` — сеттер для поля электронной почты.

#### Класс CompletedOrder

Класс CompletedOrder представляет компонент, который отображает сообщение о успешно оформленном заказе. Он встраивается в существующую HTML-структуру, отвечает за показ количества синапсов в заказе и предоставляет возможность закрыть это сообщение.

- `constructor(container: HTMLElement, total: number)` - Принимает элемент, который будет являться контейнером  и потраченное количество синапсов.

Поля класса:
- `_closeButton: HTMLElement` — кнопка закрытия
- `_description: HTMLElement` — количество потраченных синапсов.

#### Класс ViewManager

Класс отвечает за управление визуальным интерфейсом страницы: каталогом товаров, счётчиком корзины . Он обрабатывает события, управляет элементами DOM и изменяет внешний вид страницы в зависимости от её состояния.

- `constructor(container: HTMLElement, events: IEvents)` - Принимает элемент, который будет являться контейнером и экземпляр брокера событий (класса `EventEmitter`), обеспечивающего генерацию и обработку событий.

Поля класса:
`_cartCounter: HTMLElement` — счетчик корзины.
`_products: HTMLElement `— элементы каталога товаров
`_cartButton: HTMLElement` — элемент кнопки корзины

Методы:
- `setCounter(value: number)` - Устанавливает значение счетчика товаров в корзине.
- `setProducts(items: HTMLElement[])` - Устанавливает массив элементов HTML, представляющих товары в каталоге.

### Слой коммуникации

#### Класс AppApi
В конструктор принимает экземпляр класса API и предоставляет методы для взаимодействия с backend-сервисом.

Класс `AppApi` предоставляет методы для работы с API приложения: получения информации о товарах и оформления заказов. Он использует базовый `API (_baseApi) `и добавляет дополнительную логику для взаимодействия с CDN.

Конструктор принимает два аргумента:

- `cdnUrl: string` - URL CDN для изображений.
- `baseUrl: string` - экземпляр базового API.

Поля класса:

`_baseUrl` - содержит URL для работы с API
`cdnUrl` - содержит URL CDN для изображений продуктов.
Методы:
`api` - объект API для взаимодействия с сервером

- `getProducts(): Promise<IProduct[]>` - загружает набор товаров.
- `getProduct(id: string): Promise<IProduct>` - загрузка товара по идентификатору.
- `orderProducts(order: IBuyer): Promise` - отправка заказа.

## Взаимодействиее компонентов 
Логика связывания представлений и данных реализована в файле `index.ts`, который выполняет роль презентера.
Взаимодействие между слоями организовано через события, генерируемые с помощью брокера событий, и их обработчики, определённые в этом же файле.
В начале `index.ts` создаются экземпляры всех необходимых классов, после чего настраиваются соответствующие обработчики событий.

*Список всех событий, которые могут генериться в системе*
*События изменения данных (генерируются классами моделями данных)*

- `products:preview` — при выборе товара для предпросмотра в ProductsData.
- `cart:changed` — после добавления/удаления товара или очистки корзины в CartData.
- `cart:cleared`— при полной очистке корзины в CartData.
- `buyer:validated:payment` — после проверки валидности формы оплаты в BuyersData.
- `buyer:validated:contact` — после проверки валидности контактной формы в BuyersData.

*События возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за предсталения)*

- `product:open` — при клике на карточку товара для открытия модального окна.
- `product:add-to-cart` — при клике на кнопку «Добавить в корзину» в карточке товара.
- `product:remove-from-cart` — при клике на кнопку «Удалить из корзины» в карточке товара.
- `modal:open` — при открытии любого модального окна.
- `modal:close` — при закрытии модального окна.
- `order:open` - открытие окна оформления заказа с первой формой
- `order:change` - изменение полей формы оформления заказа
- `payment-form:submit` — при сабмите формы способа оплаты.
- `contact-form:submit` — при сабмите формы контактных данных.
- `checkout:confirm` — при подтверждении оформления заказа.
- `modal:form:input` — при вводе данных в поля форм внутри модального окна.
- `cart:open` — при нажатии на кнопку открытия корзины.
- `cart:close` — закрытие корзины.

